interface ethernet 1
  channel-group 1000 mode active
interface port-channel 1000
  switchport mode trunk
  switchport trunk group MLAG-Peer 
  mtu 9214
vlan 4094
  trunk group MLAG-Peer
interface vlan 4094
  no autostate
  ip address {{ underlay[inventory_hostname]['interfaces']['Vlan4094']['ipv4']}}/{{ underlay[inventory_hostname]['interfaces']['Vlan4094']['mask']}}
no spanning-tree vlan-id 4094
mlag configuration
  domain-id MLAG
  local-interface Vlan4094
  peer-link port-channel 1000
  peer-address {{ underlay[inventory_hostname]['MLAG']['mlag-peer']}}
{% for item in underlay[inventory_hostname]['interfaces'] %}
interface {{ item }}
  ip address {{ underlay[inventory_hostname]['interfaces'][item]['ipv4']}}/{{ underlay[inventory_hostname]['interfaces'][item]['mask']}}
{% if 'Ethernet' in item %}
  no switchport
  mtu 9214
{% endif %}
{% endfor %}
ip prefix-list LOOPBACK
  permit 192.168.101.0/24 eq 32
route-map LOOPBACK permit 10
  match ip address prefix-list LOOPBACK
router bgp {{ underlay[inventory_hostname]['BGP']['ASN'] }}
  router-id {{ underlay[inventory_hostname]['interfaces']['loopback0']['ipv4']}}
{% for peer in underlay[inventory_hostname]['BGP']['spine-peers'] %}
  neighbor {{ peer }} peer group SPINE_Underlay
{% endfor %}
{% for peer in underlay[inventory_hostname]['BGP']['ibgp-peer'] %}
  neighbor {{ peer }} peer group LEAF_Peer
  neighbor LEAF_Peer remote-as {{ underlay[inventory_hostname]['BGP']['ASN']}}
{% endfor %}
  no bgp default ipv4-unicast
  maximum-paths 3
  distance bgp 20 200 200
  neighbor SPINE_Underlay peer group
  neighbor SPINE_Underlay remote-as 65100
  neighbor SPINE_Underlay send-community
  neighbor SPINE_Underlay maximum-routes 12000
  neighbor LEAF_Peer peer group 
  neighbor LEAF_Peer next-hop-self
  neighbor LEAF_Peer maximum-routes 12000
  redistribute connected route-map LOOPBACK
  redistribute connected
  address-family ipv4
    neighbor SPINE_Underlay activate
    neighbor LEAF_Peer activate
    neighbor DCI_Underlay activate