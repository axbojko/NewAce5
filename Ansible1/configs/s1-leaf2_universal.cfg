interface ethernet 1
  channel-group 1000 mode active
interface ethernet 4
  channel-group 10 mode active
interface port-channel 10
  switchport mode trunk
  mlag 10
interface port-channel 1000
  switchport mode trunk
  switchport trunk group MLAG-Peer 
  mtu 9214
vlan 4094
  trunk group MLAG-Peer
interface vlan 4094
  no autostate
  ip address 192.168.255.2/30
no spanning-tree vlan-id 4094
mlag configuration
  domain-id MLAG
  local-interface Vlan4094
  peer-link port-channel 1000
  peer-address 192.168.255.1
interface loopback0
  ip address 192.168.101.12/32
interface loopback1
  ip address 192.168.102.11/32
interface Ethernet2
  ip address 192.168.103.6/31
  no switchport
  mtu 9214
interface Ethernet3
  ip address 192.168.103.8/31
  no switchport
  mtu 9214
interface Ethernet6
  ip address 169.169.169.2/30
  no switchport
  mtu 9214
interface Vlan4094
  ip address 192.168.255.2/30
ip prefix-list LOOPBACK
  permit 192.168.101.0/24 eq 32
route-map LOOPBACK permit 10
  match ip address prefix-list LOOPBACK


ip virtual-router mac-address 001c.7300.0099
vrf instance Red
ip routing vrf Red
vrf instance Blue
ip routing vrf Blue
vlan 10 
vlan 20 
interface vlan 10
    vrf Red
    ip address virtual  10.0.0.254/24
    no autostate
interface vlan 20
    vrf Blue
    ip address virtual  20.0.0.254/24
    no autostate
interface vxlan 1
  vxlan source-interface loopback 1
  vxlan udp-port 4789
  vxlan vlan 10 vni 1010
  vxlan vlan 20 vni 2020
  vxlan vrf Red vni 1111
  vxlan vrf Blue vni 2222
 



router bgp 65101
  router-id 192.168.101.12
  neighbor 192.168.103.7 peer group SPINE_Underlay
  neighbor 192.168.103.9 peer group SPINE_Underlay
  neighbor 169.169.169.1 peer group LEAF_Peer
  neighbor LEAF_Peer remote-as 65101
  neighbor 192.168.101.101 peer group EVPN
  neighbor 192.168.101.102 peer group EVPN
  no bgp default ipv4-unicast
  maximum-paths 3
  distance bgp 20 200 200
  neighbor SPINE_Underlay peer group
  neighbor SPINE_Underlay remote-as 65100
  neighbor SPINE_Underlay send-community
  neighbor SPINE_Underlay maximum-routes 12000
  neighbor LEAF_Peer peer group 
  neighbor LEAF_Peer next-hop-self
  neighbor LEAF_Peer maximum-routes 12000
  neighbor EVPN peer group 
  neighbor EVPN update-source loopback0
  neighbor EVPN ebgp-multihop 3
  neighbor EVPN send-community
  neighbor EVPN maximum-routes 0
  neighbor EVPN remote-as 65100
  redistribute connected route-map LOOPBACK
  address-family ipv4
    neighbor SPINE_Underlay activate
    neighbor LEAF_Peer activate
    redistribute connected
    exit
  address-family evpn
    bgp next-hop-unchanged
    neighbor EVPN activate
    exit

    vlan 10
        rd 192.168.101.12:10
        route-target both 10:10
        redistribute learned
        exit
    vlan 20
        rd 192.168.101.12:20
        route-target both 20:20
        redistribute learned
        exit
    vrf Red
        rd 192.168.101.12:1111
        route-target import evpn 1111:1111
        route-target export evpn 1111:1111
        redistribute connected
        exit
    vrf Blue
        rd 192.168.101.12:2222
        route-target import evpn 2222:2222
        route-target export evpn 2222:2222
        redistribute connected
        exit






